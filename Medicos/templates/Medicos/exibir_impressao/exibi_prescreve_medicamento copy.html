{% extends 'global/template_geral.html' %}
{% block css %}
{% load static %}
<link rel="stylesheet" href="{% static 'global/tabela/css/style.css' %}">
<link rel="stylesheet" href="{% static 'global/css/menu/menu-vertical-medico.css' %}">
<link rel="stylesheet" href="{% static 'global/css/abas_horizontais.css' %}">

<!--CRIA PDF-->
       <!-- Importa a biblioteca pdfmake -->
       <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/pdfmake.min.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/vfs_fonts.js"></script>
       <!-- Importa a biblioteca html2canvas -->
       <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<!--FIM CRIA PDF-->

</head>

<style> {% for dados in paciente_triagem  %} 
              {% if dados.classifica_tipo.id == 1 %}
              .dados-preatendimento ul li span{
                     color: #AA0000;
                     font-size: 1.3rem;
              }
              {% elif dados.classifica_tipo.id == 2  %}
              .dados-preatendimento ul li span{
                     color: #ff6600;
                     font-size: 1.3rem;
              {% elif dados.classifica_tipo.id == 3  %}
              .dados-preatendimento ul li span{
                     color:  #008200;
                     font-size: 1.3rem;
              {% elif dados.classifica_tipo.id == 4  %}
              .dados-preatendimento ul li span{
                     color: #008dc0;
                     font-size: 1.3rem;
              {% endif %}  
       {% endfor %}  
       
       .modal {
              display: none;
              position: fixed;
              z-index: 15;
              left: 0;
              top: 0;
              width: 100%;
              height: 100%;
              overflow: auto;
              background-color: rgba(0,0,0,0.4);
            }
            
            .modal-content {
              background-color: #fefefe;
              margin: 10% auto;
              padding: 20px;
              border: 1px solid #888;
              width: 70%;
              height: 50%;
            }
            
            .close {
              color: #aaa;
              float: right;
              font-size: 50px;
              font-weight: bold;
            }
            
            .close:hover,
            .close:focus {
              color: black;
              text-decoration: none;
              cursor: pointer;
            }
            
            #iframe {
              display: block;
              width: 100%;
              height: 100%;
            }
</style>


<script>


</script>

{% endblock css %}  
<!--Imagem Representando o setor-->
{% block vetor-img-aereo %}<img src=" {% static 'home/doctor.fw.png' %} " alt="">{% endblock vetor-img-aereo %}
<!--END Imagem Representando o setor-->
{% block title_login %}ÁREA MÉDICA {% endblock title_login %}
{% block titulo_ %} 
       ÁREA MÉDICA - Paciente: {{triagem}}

{% endblock titulo_ %} 
{% block body_title %}
       ÁREA MÉDICA - Paciente: {{triagem}}
{% endblock body_title %}
{% block body_login %} 
{% for t in triagem_now %} 

<div style='width:100%'>
       <ul class="menu-abas ">              
                     {% if not t.preescrever_medicamento_medico == 'Preescreva o medicamento para o paciente' %}    
                            <li class='prescricao border-radius'><a href="#tab1">&nbsp;&nbsp;Preescrever Medicamento <i class="fa-solid fa-capsules"></i>&nbsp;&nbsp;</a></li>
                     {% endif %} 
                     {% if not t.encaminhamento == 'Digite o encaminhamento do paciente' %} 
                            <li class='encaminhamento'><a href="#tab2">&nbsp;&nbsp;Encaminhamentos <i class="fa-regular fa-paste"></i>&nbsp;&nbsp;</a></li>                            
                     {% endif %}
                     {% if not t.exames == 'Preencha com a relação de exames' %}   
                            <li class='exames'><a href="#tab3">&nbsp;&nbsp;Exames <i class="fa-solid fa-notes-medical"></i>&nbsp;&nbsp;</a></li>
                     {% endif %}
                     {% if not t.atestado == 'Digite a quantidade de dias que o paciente irá ficar de repouso' %}
                            <li class='atestado'><a href="#tab4">&nbsp;&nbsp;Atestados <i class="fa-solid fa-file-contract"></i></i>&nbsp;&nbsp;</a></li>
                     {% endif %}                       
              {% endfor %}        
       </ul>         
       <article>
              
              {% for t in triagem_now %} 
                     {% if not t.preescrever_medicamento_medico == 'Preescreva o medicamento para o paciente' %}           
                            <section class='prescricao' id="tab1" class="active"> 
                                   <nav class="menu-vertical-medico">
                                          <ul>                                          
                                                 <li><a  href="{% url 'Medicos:geraPdf' t.id %}" onclick="gerarPDF(); return false;" ><i class="fa-solid fa-print" ></i> Imprimir/PDF</a></li>
                                                 <li><a href="{% url 'Medicos:final_medico_concluida' t.id %}"><i class="fa-solid fa-arrow-right-to-bracket"></i>  FINALIZAR ATENDIMENTO </a></li>
                                          </ul>
                                   </nav> 
                                   <!--Imprimir medicamentos-->
                                   <div id='tab11' style='width:550px; height:720px; margin:auto;
                                   box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);
                                   -webkit-box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);
                                   -moz-box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);'>
                                          <img src="{% static 'sus.png' %}  " alt="">
                                          <div class='card-medico' style="              
                                                 position: relative;
                                                 z-index: 10;
                                                 top: -40rem;
                                                 padding: 2.5rem;">                                   
                                                 <h3>Nome do(a) paciente:</h3>
                                                 <p style='margin-left:2rem' class='uppercase'><strong>{{t}}</strong></p>
                                                 <h3>Preescrição de Medicamento:</h3>
                                                 <p style='margin-left:2rem; height:12rem'>{{t.preescrever_medicamento_medico}}</p>
                                                 <nav class="menu-vertical-medico">
                                                        
                                                 </nav> 
                                          
                                          <h3>Médico que fez o atendimento:</h3>
                                          <p style='margin-left:2rem'>Dr.(a) {{request.user}}</p>
                                   </div> 
                                   <!--FIM Imprimir medicamentos-->
                            </section>
                     {% endif %}
                     <!--Imprimir Encaminhamentos-->
                     {% if not t.encaminhamento == 'Digite o encaminhamento do paciente' %}  
                            <section style='width:93.5%' class='encaminhamento' id="tab2">
                                  
                            </section>
                      {% endif %}
                      <!--FIM Encaminhamentos-->
                      <!-- Imprimir medicamentos Exames-->
                      {% if not t.exames == 'Preencha com a relação de exames' %}         
                            <section class='exames' id="tab3">
                                   
                            </section>
                     {% endif %}  
                     <!--FIM Imprimir exames-->
                     <!--Imprimir Atestados-->
                     {% if not t.atestado == 'Digite a quantidade de dias que o paciente irá ficar de repouso' %}
                            <section class='atestado' id="tab4">
                                   <nav class="menu-vertical-medico">
                                          <ul>                                          
                                                 <li><a  href="{% url 'Medicos:geraPdf' t.id %}" onclick="gerarAtestPDF(); return false;" ><i class="fa-solid fa-print" ></i> Imprimir/PDF</a></li>
                                                 <li><a href="{% url 'Medicos:final_medico_concluida' t.id %}"><i class="fa-solid fa-arrow-right-to-bracket"></i>  FINALIZAR ATENDIMENTO </a></li>
                                          </ul>
                                   </nav> 
                                   <!--Imprimir Atestados-->
                                   <div id="tab44" style='width:550px; height:720px; margin:auto;
                                   box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);
                                   -webkit-box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);
                                   -moz-box-shadow: 0px -1px 10px 4px rgba(41, 41, 41, 1);'>
                                          <img src="{% static 'sus.png' %}  " alt="">
                                          <div class='card-medico' style="              
                                                 position: relative;
                                                 z-index: 10;
                                                 top: -40rem;
                                                 padding: 2.5rem;">
                                                 <p>&nbsp;</p>                    
                                                 <h3>ATESTADO MÉDICO</h3>
                                                 <p>&nbsp;</p> 
                                                 <p style='margin-left:2rem; font-size:0.8rem' class='uppercase'>Atesto para os devidos fins que <strong style='font-size:1rem'>{{t}}</strong> esteve sob
                                                 tratamento médico nesta unidade de saúde, no dia <strong style='font-size:1rem'>{{t.data_triagem}}</strong>, necessitando de <strong style='font-size:1rem'>{{t.atestado}}</strong> dias de afastamento a partir desta data,
                                          por motivo de doença. </p>
                                                 <p style='margin-left:2rem' class='uppercase'><strong></strong></p>
                                                 
                                                 <div style='margin-left:2rem; margin-top:2.5rem; height:12rem'>

                                                        <p>CID 10: <p>
                                                        <p>{% for t in cid10  %}
                                                                      <b>{{t.classificacao_internacional_doenca_CID}}</b>
                                                               {% endfor %}
                                                        </p>
                                                        <p>&nbsp;</p>
                                                        <p style='text-align:right'>Vera Cruz, {{t.data_triagem}}</p>
                                                 </div>                                                
                                          <div style='margin-top:-3rem; text-align: center'>
                                                 <h3>Médico que fez o atendimento:</h3>
                                                 <p style='margin-left:2rem'>Dr.(a) {{request.user}}</p>
                                          </div>
                                   </div> 
                                   <!--fim Imprimir Atestados-->
                            </section>
                     {% endif %}  
                       
       </article> 
</div>
{% endfor %}  
<!-- Modal HTML -->
<div id="myModal" class="modal">
       <div class="modal-content">              
         <span class="close">&times;</span>
         {% for t in triagem_now %}   
         <h1>Atenção</h1>

         <p>Apos realizar a impressão, você deverá clicar no botão
              FINALIZAR ATENDIMENTO, para que o nome do paciente saia
              da fila de atendimento do dia e seus dados sejam armazenados 
              em seu histórico hospitalar .
         </p> 
         <p>
              Se ainda não imprimiu todos os documentos do paciente <b class='uppercase'>{{t.paciente_triagem}}</b>, utilize os links abaixo para 
                     imprimir o restante dos documentos ou clique no &times; para visualiza-los na tela: 
                     <ul>{% if not t.preescrever_medicamento_medico == 'Preescreva o medicamento para o paciente' %}
                            <li>                                   
                            <a href="#tab1" onclick="gerarPDF(); return false;" ><b>Prescrição de medicamentos</b></a>                                   
                            </li>
                            {% endif %}
                            {% if not t.encaminhamento == 'Digite o encaminhamento do paciente' %}
                            <li>                                          
                            <a href="#tab2" onclick="gerarPDF(); return false;" ><b>Encaminhamento</b></a>                                          
                            </li>
                            {% endif %}
                            {% if  not t.exames == 'Preencha com a relação de exames' %}
                            <li>
                                   
                                   <a href="#tab3" onclick="gerarPDF(); return false;" > <b>Solicitação de exames</b></a>
                                   
                            </li>
                            {% endif %}
                            <li>
                            {% if not t.atestado == 'Digite a quantidade de dias que o paciente irá ficar de repouso' %}
                            <a href="#tab4" onclick="gerarAtestPDF(); return false;" ><b>Atestado<b></a>
                            {% endif %}
                            </li>                            
                            
                            
                     </ul>
         </p>
         <p>&nbsp;</p>
               
         <nav class="menu-vertical-medico">
              <ul  style='margin-left:-17rem; margin-top:2rem'>
                     <li><a href="{% url 'Medicos:final_medico_concluida' t.id %}"><i class="fa-solid fa-arrow-right-to-bracket"></i>  FINALIZAR ATENDIMENTO </a></li>
              </ul>
       </nav>
       {% endfor %} 
       </div>
     </div>   







  




 <!-- XXXXXXXXXXXXXXXXXX  GERA O PDF XXXXXXXXXXXXXXXXXX --> 
<script>
       //PDF Prescreve Medicamento ------------------------------------------------------------

   function gerarPDF() {
        // Seleciona o elemento com o ID "tab1"
        const elementToPrint = document.querySelector('#tab11');
        console.log(elementToPrint)
        html2canvas(elementToPrint, {
            onrendered: function(canvas) {
                // Define as dimensões da página A4 em pixels
                const pageSize = { width: 595, height: 842 };
                // Define as margens em pixels
                const margin = 20;
                // Converte a imagem do canvas para um formato de dados base64
                const imgData = canvas.toDataURL('image/png');
                const img = new Image();
                img.onload = function() {
                    // Calcula a proporção da largura da imagem em relação à largura da página
                    const widthRatio = pageSize.width / (img.width + 2 * margin);
                    // Calcula a altura da imagem com base na proporção da largura
                    const imgHeight = img.height * widthRatio;
                    // Define as configurações do PDF
                    const pdfDefinition = {
                        pageSize: pageSize,
                        pageOrientation: 'portrait',
                        pageMargins: [margin, margin, margin, margin],
                        content: [
                            {
                                image: imgData,
                                width: pageSize.width - 2 * margin,
                                height: imgHeight
                            }
                        ]
                    };
                    // Abre um pop-up com o PDF
                    popupPDF();
                    const pdfWindow = window.open('', '_blank', 'width=600,height=800');
                    // Cria o PDF e o salva em um blob
            
              pdfMake.createPdf(pdfDefinition).getBlob(function (blob) {
            const url = URL.createObjectURL(blob);
            pdfWindow.location.href = url;
          });
        };
        img.src = imgData;
      }
    });
  }
  //PDF Prescreve Atestado ------------------------------------------------------------
  function gerarAtestPDF() {
       // Seleciona o elemento com o ID "tab4"
       const elementToPrint = document.querySelector('#tab44');
       console.log(elementToPrint)
       html2canvas(elementToPrint, {
           onrendered: function(canvas) {
               // Define as dimensões da página A4 em pixels
               const pageSize = { width: 595, height: 842 };
               // Define as margens em pixels
               const margin = 20;
               // Converte a imagem do canvas para um formato de dados base64
               const imgData = canvas.toDataURL('image/png');
               const img = new Image();
               img.onload = function() {
                   // Calcula a proporção da largura da imagem em relação à largura da página
                   const widthRatio = pageSize.width / (img.width + 2 * margin);
                   // Calcula a altura da imagem com base na proporção da largura
                   const imgHeight = img.height * widthRatio;
                   // Define as configurações do PDF
                   const pdfDefinition = {
                       pageSize: pageSize,
                       pageOrientation: 'portrait',
                       pageMargins: [margin, margin, margin, margin],
                       content: [
                           {
                               image: imgData,
                               width: pageSize.width - 2 * margin,
                               height: imgHeight
                           }
                       ]
                   };
                   // Abre um pop-up com o PDF
                   popupPDF();
                   const pdfWindow = window.open('', '_blank', 'width=600,height=800');
                   // Cria o PDF e o salva em um blob
           
             pdfMake.createPdf(pdfDefinition).getBlob(function (blob) {
           const url = URL.createObjectURL(blob);
           pdfWindow.location.href = url;
         });
       };
       img.src = imgData;
     }
   });
 }
</script>












   

<script>

       function popupPDF(url) {
  var modal = document.getElementById("myModal");
  var span = document.getElementsByClassName("close")[0];

  modal.style.display = "block";

  span.onclick = function() {
    modal.style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
}

      
            
            
</script>
{% endblock body_login %}