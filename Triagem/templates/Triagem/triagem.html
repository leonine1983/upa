{% extends 'global/template_geral.html' %}
{% load static %}
{% block title_login %}ENFERMARIA > Triagem {% endblock title_login %}
{% block titulo_ %}Triagem{% endblock titulo_ %} 

<!--Imagem Representando o setor-->
{% block vetor-img-aereo %}{% endblock vetor-img-aereo %}
<!--END Imagem Representando o setor-->
{% block body_title %}<i class="fa-solid fa-laptop-medical"></i> CLASSIFICAÇÃO DE PACIENTES {% endblock body_title %}

{% block css %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href=" {% static 'global/css/tabela.css' %}">
  <link rel="stylesheet" href=" {% static 'global/css/modal.css' %}">
  <link rel="stylesheet" href=" {% static 'global/css/formularios.css' %}">
  <link rel="stylesheet" href=" {% static 'global/css/abas_especiais_pcss3t.css' %}">
  <style>
      .modal{
          width: 80%;
      }
      .red {
          background-color: red !important;          
        }    
      .orange {
        background-color: orange !important;
      }  
      .yellow {
        background-color: yellow !important;
      }  
      .green {
        background-color: green !important;
      }
      .font{
        display:block;
        width:100%;
        color: white;
        padding:0.5rem        
      }
      .font2{
        display:block;
        width:100%;
        color: black !important;
        padding:0.5rem
      }
      #id_paciente_triagem{
        width:200%;
      }
      .hours48{
        position: absolute;
        margin-top: -1.5rem !important;
        font-size: 0.7rem;
        margin-left: 0;
        padding: 0.1rem;
        color:rgb(255, 255, 255) ;
      }
    {% if info_extra == 'Analisando...' %}
      .form-body {      
        margin:1rem;
        background: #dbecdb;
        padding:1rem;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap:2rem;
    }
    

    {% endif %}
    .form-body div:last-child{width:132.5%!important}
    .floating-form-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
  }
 
  /* Estilo dos botões */
  .modal-buttons {
       display: flex;
       justify-content: center;
       margin-top: 20px;
  }
  .modal-buttons button {
       margin: 0 5px;
  }
  .floating-form-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
  }
  .floating-button {
      background-color: #3498db;
      color: #fff;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }
  .floating-form {
      display: none;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  } 
  .floating-form label,
  .floating-form input,
  .floating-form button {
      display: block;
      margin-bottom: 10px;
  } 
  .floating-form button {
      background-color: #3498db;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
  } 
  .floating-form button:hover {
      background-color: #2980b9;
  }
 #retorned{
  position: relative;
  border-top-left-radius: 1rem;
  top:-0.3rem;
  left: -1rem;
  box-shadow: rgba(0, 0, 0, 0.15) 1.95px 1.95px 2.6px;
  
 }

  </style>
{% endblock css %}

{% block body_login %}


<div class='flex' style='color: var(--cor-background-titulo); margin-bottom:-2rem '>
  {% if object.paciente_triagem %}<!-- Modal para exibir a mensagem 
    <div>Paciente em Atendimento: <hr> </div>  
        <h2 class='uppercase' style=''>
            <i class="fa-solid fa-syringe"></i>
         {% for dados in paciente_triagem %}           
                {{dados}} 
         {% endfor %}         
        </h2>       -->
    </div> 
    <!--Avisa se o paciente tem ALERGIAS--> 
    {% if object %} 

    <!--menu info usuario hamburger-->
    
    <!--end menu info usuario hamburger-->

      {% if object.paciente_triagem.horas48 %}
      <div id="retorned" class="bg-danger text-dark-emphasis w-25 p-1">Paciente retornou em menos de 48 horas <i class="fa-thin fa-skull-crossbones"></i></div>
      {% endif %}

      {% if not object.paciente_triagem.paciente_envio_triagem.alergias == '0' %}      
        {% if not dados.conteudo_alergia == 'Não possui alergias (Para tornar editável essa área, é necessário informar que o paciente possui alergias)' %}
          <div style='text-align:center; margin-bottom:2rem'>
            <!-- Botão para abrir o modal -->
            <button type="button" class="cancelar btn btn-primary" style='background:red' data-toggle="modal" data-target="#myModal_alergia">
              Paciente Alérgico <i class="fa-solid fa-person-dots-from-line"></i>
            </button>          
            </div>
              <div class="modal fade " id="myModal_alergia" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog " role="document">
                  <div class="modal-content ">
                      <div class="modal-header cancelar ">
                      <h3 class="modal-title" style='color:#fff' id="exampleModalLabel"><i class="fa-solid fa-hand-dots"></i> Paciente Alégico</h3>
                      <button type="button" class="close excluir" data-dismiss="modal" aria-label="Fechar">
                        <h1 class='h3 text-danger text-center text-u'>Paciente Alégico <i class="fa-solid fa-hand-dots"></i></h1>
                      </button>
                      </div>
                      <div class="modal-body p-3 fs-5">
                        <i class="fa-duotone fa-quote-left fa-fade" style="--fa-primary-color: #e50606; --fa-secondary-color: #e50606;"></i>
                          
                          {{object.paciente_triagem.paciente_envio_triagem.conteudo_alergia}}
                      </div>
                  </div>
                </div>
              </div> 
              <script>
                var jQuery = $.noConflict();
                jQuery(document).ready(function(){
                  jQuery('#myModal_alergia').modal('show');
               });               
              </script>  
          </div>             
        {% endif %}
      {% endif %} 
    {% endif %}
    <!--FIM Avisa se o paciente tem ALERGIAS--> 
  {% endif %}
<div class="top-info ">      

  
    <div>
      {% if not licenca_ativa == None %}
        <form action="" method='POST' class="" id='classifica_form'> 
          <div class="pt-4" style='margin-top:-1.8rem '>
            <div style='margin-bottom:-0.01rem' class='p-1 border rounded-2 w-100' >
              {% if nome_paciente %}
                <h3 class='fs-3'><i class="fa-duotone fa-face-thermometer "></i>&nbsp; Nome do(a) paciente: <b class='uppercase'>{{nome_paciente}} {{ nome_objeto}}</b></h3>
                {% else %}            
                <h3 class='fs-3'><i class="fa-duotone fa-face-thermometer"></i>&nbsp;Pacientes</h3>
              {% endif %}              
            </div>
            {% if not triagem_andamento %}
              <p class='p-3 fs-7 bg-primary-subtle'>No campo   <b>PACIENTE AGUARDANDO CLASSIFICAÇÃO</b> só estão disponíveis os nomes dos pacientes que estão na <b>Fila de triagem</b>. Se o nome do paciente que estiver procurando não estiver disponível nesse campo, verifique com a recepção o motivo de não terem lançado o nome do paciente na "FILA DE TRIAGEM" .  </p>
            {% endif %}
            
            {% if info_extra == 'Analisando...' %}
            {% comment "dados tabela" %}
            <table class="bg-secondary mt-4">
            </table>{% endcomment %}

            {% endif %}
          </div>          
            
            {% csrf_token %}
            <div class="{% if not tipo_titulo == 'Pré-atendimento | ALERGIAS e COMORBIDADES' %}form-body{% endif %} bg-secondary-subtle">   
              {{ form.media }}      
              {% if not tipo_titulo == 'Pré-atendimento | ALERGIAS e COMORBIDADES' %}
                
                  {{form.as_div}}
               
                {% else %}
                <!-- tabs -->
                <div class="pcss3t pcss3t-effect-scale pcss3t-theme-1 shadow"  {% if not tipo_titulo == 'Pré-atendimento | ALERGIAS e COMORBIDADES' %}form-body{% endif %}>
                  <input type="radio" name="pcss3t" checked  id="tab1"class="tab-content-first">
                  <label for="tab1"><i class="fa-solid fa-person-dots-from-line"></i> Alergias:</label>
                  
                  <input type="radio" name="pcss3t" id="tab2" class="tab-content-2">
                  <label for="tab2"><i class="fa-sharp fa-solid fa-person-running-fast"></i> Comorbidades:</label>
                  <ul>
                    <li class="tab-content tab-content-first typography bg-dark-subtle">
                        <div class="fs-4" >{{form.alergias.label_tag}}</div>
                        {% for error in form.alergias.errors %}
                        <div style="color: red;">{{ error }}</div>
                        {% endfor %}                            
                        <p>{{form.alergias}}</p>
                        {{form.conteudo_alergia}}
                    </li>
                    
                    <li class="tab-content tab-content-2 typography bg-dark-subtle">
                        <div class="fs-4" >{{form.comorbidades.label_tag}}</div>
                        {% for error in form.comorbidades.errors %}
                        <div style="color: red;">{{ error }}</div>
                        {% endfor %}                            
                        <p>{{form.comorbidades}}</p>
                        {{form.conteudo_comorbidades}}
                    </li>
                  </ul>
                </div>
                <!--/ tabs -->
              
              {% endif %}     
                
                {% comment "Classificação de risco automatica desativada" %} 
                {% if info_extra == 'Analisando...' %}   
                  <div >
                   
                  </div>                
                {% endif %}
                {% endcomment %}
                {% if classifica %}
                  <img src="{% static 'cores-protocolo-manchester-1.jpg' %} " width="100%" alt="" class="shadow shadow-sm shadow-lg">
                {% endif %}
            </div>
            
            {% if tipo_titulo == 'Excluir paciente da triagem' %}
            <a class="class='btn btn-sm btn-primary m-3 " href="{% url 'Triagem:triagem-enfermaria' %}">cancelar</a>
            {%endif%}  
            {% if exibe_id is not None %}{% if not chamado.chamado %}        
            <button style='margin-left:10%!important' class='btn btn-sm btn-primary m-3 w-75 fs-5
            {% if tipo_titulo == 'Excluir paciente da triagem' %}
             btn-danger
             {% endif %}
            
            ' type="submit" 
              {% if tipo_titulo == 'Pré-atendimento | ALERGIAS e COMORBIDADES' %}
              Salvar informações do paciente
              {% elif tipo_titulo == 'Excluir paciente da triagem' %}
              Deletar {{ nome_objeto}} da triagem

              {% else %}                
              Iniciar Classificação do Paciente
              {% endif %}     
              <i class="fa-solid fa-person-walking-arrow-right"></i></button> 
              {% endif %} {% endif %}>
              {% if exibe_id is not None %}
                            {% if not chamado.chamado %}
                            <div class="card text-center m-auto">
                                   <div class="card-header bg-danger text-light">
                                   ATENÇÃO!!!
                                   </div>
                                   <div class="card-body">
                                   <p class="card-text">🔄 Para prosseguir ou cancelar o atendimento,
                                          é necessário cancelar a chamada do paciente no painel. 
                                          Pressione o botão localizado na parte inferior à direita da tela.</p>
                                   </div>
                                   
                                   <div class="card-footer text-danger">
                                          Chamada Ativa <i class="fa-solid fa-volume-xmark"></i>
                                   </div>
                            </div>
                            {% endif %} 
                     {% endif %}
        </form> 
        {% else %}
        <div class='m-5 fs-3'>
          <h3 class='h1'><i class="fa-thin fa-circle-exclamation text-danger"></i> Prezado usuário,</h3>
          <p class='p-2'>Informamos que a licença de uso do sistema SG-UPA expirou. Para continuar utilizando o sistema, solicitamos que entre em contato com o administrador pelo seguinte número de telefone (WhatsApp): **(71) 9 8688 1943 - Rogério Cerqueira da Silva**.

          Agradecemos pela compreensão e colaboração.

          Atenciosamente,</p>

          <p class='p-2'>Equipe de Suporte Técnico</p>
        </div>
      {% endif %}
      
        
        
        {% if conteudo == 'paciente_na_triagem' %}
        <h1 class='h2 h-100 bg-purple mt-5 p-2'><i class="fa-solid fa-arrow-trend-up"></i> Pacientes em atendimento pela triagem</h1>
        <table class='table table-striped'>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Data e horário de inicio</th>                
              <th>Mãe</th>                       
              <th>Ação</th> 
            </tr>
          </thead>
          <tbody>
            {% for pac in paciente_na_triagem  %}
            <tr {% if pac.paciente_triagem.horas48 %} style="border: solid red 0.125rem;" class='bg-danger-subtle  '{% endif %}> 
              <td>
                {% if pac.paciente_triagem.horas48 %}<div class="hours48 bg-danger border p-1 pe-3 px-3 rounded-end-5 "><i class="fa-thin fa-skull-crossbones"></i> Retornou em menos de 48 horas</div>{% endif %}
                {{pac.paciente_triagem}}
              </td>
              <td>
                {{pac.data_triagem}} || {{pac.hora_triagem}}
              </td>
              
              <td>
                {{pac.paciente_triagem.paciente_envio_triagem.nome_mae}}
              </td>
              
              <td >
                <a class='btn btn-sm btn-secondary' href="{% url 'Triagem:triagem-enfermaria-update' pac.id %}">Continua atendimento</a>                
                <a class='btn btn-sm btn-danger' href="{% url 'Triagem:triagem-delete' pac.id %}">Excluir da triagem</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4">Nenhum paciente encontrado.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 
        
        
        <h1 class='h2 h-100 bg-purple mt-5 p-2'><i class="fa-solid fa-arrow-trend-down"></i> Triagens finalizadas hoje</h2>
        <table class='table table-striped  table-active border border-1  '>
          <thead>
            <tr>
              <th class="text-center">Nome do paciente</th>
              <th>Mãe</th>                   
              <th class="text-center">Classificação de risco atribuída</th>    
              <th>Ação</th> 
            </tr>
          </thead>
          <tbody>
            {% for pac in paciente_na_triagem_concluidos %}
            <tr {% if pac.paciente_triagem.horas48 %} style="border: solid red 0.125rem;" class='bg-danger-subtle  '{% endif %}>
              <td >
                {% if pac.paciente_triagem.horas48 %}<div class="hours48 bg-danger border p-1 pe-3 px-3 rounded-end-5 "><i class="fa-thin fa-skull-crossbones"></i> Retornou em menos de 48 horas</div>{% endif %}
                {{pac.paciente_triagem}}
              </td>
              <td>
                {{pac.paciente_triagem.paciente_envio_triagem.nome_mae}}
              </td>
              
              <td class="text-center ">
                {{pac.classifica_tipo}}
              </td>
              <td>
                <a class='btn btn-sm btn-primary' href="{% url 'Triagem:triagem_classifica_Risco_update' pac.id %}">Reavaliar Paciente</a>               
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table> 
        {% endif %}
        <div>&nbsp;</div> 
    </div>
   </div>  
   
  <!--Botão chamar paciente-->
  {% if triagem_andamento == 'exibe' %}{% include "Triagem/triagem_partes/botao_chamar.html" %}{% endif %}
  <!--END Botão chamar paciente-->
</div>
   

{% block script %}   
  <script>
    var alergiasField = document.getElementById("id_alergias");
    var alergiasContentField = document.getElementById("id_conteudo_alergia");
    var comorbidadesField = document.getElementById("id_comorbidades");
    var comorbidadesContentField = document.getElementById("id_conteudo_comorbidades")

    // desabilita o campo "alergias_content" quando a página é carregada
    alergiasContentField.disabled = true;
    comorbidadesContentField.disabled = true

    // habilita ou desabilita o campo "alergias_content" quando o usuário seleciona uma opção diferente
    alergiasField.addEventListener("change", function() {
        if (alergiasField.value == "1") {
            alergiasContentField.disabled = false;
        } else {
            alergiasContentField.disabled = true;
            alergiasContentField.value = 'Não possui alergias (Para tornar editável essa área, é necessário informar que o paciente possui alergias)';
        }
    });  
    comorbidadesField.addEventListener("change", function(){
      if (comorbidadesField.value == "1"){
        comorbidadesContentField.disabled = false;
      } else{
        comorbidadesContentField.disabled = true;
        comorbidadesContentField.value = 'Não possui comorbidades (Para tornar editável essa área, é necessário informar que o paciente possui comorbidades)'
      }
    })

</script>

<script src="{% static 'global/js/select2.min.js' %}"></script>
    <script>
        // In your Javascript (external .js resource or <script> tag)
    $(document).ready(function() {
        $('#id_paciente_triagem').select2();  
    });
</script>
<script>
  document.getElementById("id_frequencia_cardiaca_FC").addEventListener("change", function(){
    this.value = parseFloat(this.value).toFixed(2);
 });
 document.getElementById("id_frequencia_cardiaca_FC").addEventListener("change", function(){
  this.value = parseFloat(this.value).toFixed(2);
});
</script>



<!--Alterna entre chamar e cancelar paciente-->
<script>
  function toggleForm() {
      var floatingForm = document.getElementById('floatingForm');
      floatingForm.style.display = (floatingForm.style.display === 'none' || floatingForm.style.display === '') ? 'block' : 'none';
    }
    
</script>

{% endblock script %}

{% endblock body_login %}